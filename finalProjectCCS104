// Employee Record System
// Samuel Angelo Udtohan
// Nataniel Abucejo
// Jose Gabriel Tayona








#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <ctype.h>
#include <math.h>
#include <time.h>








// PLATFORM-DEPENDENT SLEEP FUNCTION 
#ifdef _WIN32
    #include <windows.h>
    #define SLEEP_FUNCTION(ms) Sleep(ms)
    #define CLEAR_COMMAND "cls"
#else
    #include <unistd.h>
    #define SLEEP_FUNCTION(ms) usleep((ms) * 1000)
    #define CLEAR_COMMAND "clear"
#endif








// SYSTEM CONSTANTS & DEFINITIONS
#define MAX_EMPLOYEES 50
#define ADMIN_PIN 1234
#define FILENAME "MonthlyAttendance.txt"
#define ATTENDANCE_FILE "employee_attendance.txt"
#define MAX_STR 100
#define STANDARD_WORKING_DAYS 22
#define MAX_WORKING_DAYS 30
#define MAX_ATTENDANCE_RECORDS 1000








// DEDUCTION CONSTANTS 
#define DEDUCTION_SSS_RATE 0.045f
#define DEDUCTION_PHILHEALTH_RATE 0.025f
#define DEDUCTION_PAGIBIG_RATE 0.02f
#define OVERTIME_RATE_MULTIPLIER 1.25f








// INCOME TAX TIERS (Updated 2024 Philippine Tax Table) 
#define TAX_TIER_1_LIMIT 20833.00f
#define TAX_TIER_2_LIMIT 33333.00f
#define TAX_TIER_3_LIMIT 66667.00f
#define TAX_TIER_4_LIMIT 166667.00f
#define TAX_TIER_5_LIMIT 666667.00f

#define TAX_RATE_TIER_2 0.15f
#define TAX_RATE_TIER_3 0.20f
#define TAX_RATE_TIER_4 0.25f
#define TAX_RATE_TIER_5 0.30f
#define TAX_RATE_TIER_6 0.35f

#define TAX_BASE_TIER_2 0.00f
#define TAX_BASE_TIER_3 2500.00f
#define TAX_BASE_TIER_4 10833.33f
#define TAX_BASE_TIER_5 40833.33f
#define TAX_BASE_TIER_6 200833.33f







// POSITION DEFINITIONS 
typedef enum { 
    SERVICE_CREW, 
    COOKER, 
    COUNTER_CREW, 
    NUM_POSITIONS 
} PositionType;








const char *PositionNames[NUM_POSITIONS] = { 
    "Service Crew", 
    "Cooker", 
    "Counter Crew" 
};








const float PositionMonthlySalaries[NUM_POSITIONS] = {
    18000.00f,
    25000.00f,
    35000.00f
};








// ATTENDANCE STRUCTURES
typedef struct {
    int empID;
    char date[11];
    char timeIn[6];
    float hoursWorked;
    char status[20];
    int isLate;
    float overtimeHours;
} AttendanceRecord;








// EMPLOYEE STRUCTURE
typedef struct {
    int empID;
    char name[50];
    PositionType position;
    float monthlySalary;
    int daysWorked;
    float totalOvertimeHours;
    float totalHoursWorked;
    float lastOvertimePay;
    float lastDailyRate;
    float lastAbsentDeduct;
    float lastGrossPay;
    float lastNetPay;
    float lastSSS;
    float lastPhilHealth;
    float lastPagIBIG;
    float lastIncomeTax;
} Employee;








// GLOBAL STORAGE
Employee employees[MAX_EMPLOYEES];
int employeeCount = 0;

AttendanceRecord attendanceRecords[MAX_ATTENDANCE_RECORDS];
int attendanceCount = 0;







// Function Prototype

// Utility Functions
void clearInputBuffer(void);
void pressEnterToContinue(void);
int getIntInput(const char *prompt, int min, int max);
void getStringInput(const char *prompt, char *out, int maxlen, int letters_spaces_only);
void getCurrentDateTime(char *date, char *timeBuf);

// Employee Management
int generateEmployeeID(void);
int findEmployeeIndexByID(int id);
int findEmployeeIndexByName(const char *name);
int isNameDuplicate(const char *name, int excludeID);
PositionType getPositionTypeByName(const char *name);
int strcasecmp(const char *s1, const char *s2);

// File Operations
void saveToFile(void);
void loadFromFile(void);
void saveAttendanceToFile(void);
void loadAttendanceFromFile(void);
void printPaySlipToFile(const Employee *e);

// Menu Functions
void mainMenu(void);
void adminMenu(void);
int verifyPin(void);

// Employee Operations
void viewEmployees(void);
void addEmployee(void);
void updateEmployee(void);
void removeEmployee(void);
void sortEmployeesByID(void);
void sortEmployeesByName(void);

// Salary Functions
void calculateAndDisplaySalary(void);
float calculateIncomeTax(float taxableIncome);
void displayEmployeeSalarySlip(int id);

// Attendance Functions
void attendanceMenu(void);
void recordTimeIn(void);
void recordAbsent(void);
void viewAttendance(void);








// Implementation

// Clears the input buffer to prevent leftover input from affecting subsequent scanf calls
void clearInputBuffer(void) {
    int c;
    while ((c = getchar()) != '\n' && c != EOF) {}
}







// Prompts user to press Enter to continue and waits for input
void pressEnterToContinue(void) {
    printf("\n\t\t\t\t                                   Press Enter to continue...");
    fflush(stdout);
    clearInputBuffer();
}








// Generates a unique 7-digit employee ID (1000000-9999999)
int generateEmployeeID(void) {
    int id;
    int attempts = 0;
    int max_attempts = 100;
    
    srand(time(NULL));
    
    do {
        id = 1000000 + (rand() % 9000000);
        attempts++;
        
        if (attempts >= max_attempts) {
            int max_id = 1000000;
            for (int i = 0; i < employeeCount; i++) {
                if (employees[i].empID > max_id) {
                    max_id = employees[i].empID;
                }
            }
            id = max_id + 1;
            if (id > 9999999) id = 1000000;
            break;
        }
    } while (findEmployeeIndexByID(id) != -1);
    
    return id;
}








// Searches for an employee by their ID and returns the index, or -1 if not found
int findEmployeeIndexByID(int id) {
    for (int i = 0; i < employeeCount; ++i) {
        if (employees[i].empID == id) return i;
    }
    return -1;
}








// Searches for an employee by their name (case-insensitive) and returns the index, or -1 if not found
int findEmployeeIndexByName(const char *name) {
    for (int i = 0; i < employeeCount; ++i) {
        if (strcasecmp(employees[i].name, name) == 0) return i;
    }
    return -1;
}








// Case-insensitive string comparison function
int strcasecmp(const char *s1, const char *s2) {
    while (*s1 && *s2) {
        int diff = tolower((unsigned char)*s1) - tolower((unsigned char)*s2);
        if (diff != 0) return diff;
        s1++;
        s2++;
    }
    return tolower((unsigned char)*s1) - tolower((unsigned char)*s2);
}








// Checks if an employee name already exists in the system (excluding specified ID)
int isNameDuplicate(const char *name, int excludeID) {
    for (int i = 0; i < employeeCount; ++i) {
        if (employees[i].empID != excludeID && strcasecmp(employees[i].name, name) == 0) {
            return 1;
        }
    }
    return 0;
}








// Converts a position name string to its corresponding PositionType enum value
PositionType getPositionTypeByName(const char *name) {
    for (int i = 0; i < NUM_POSITIONS; i++) {
        if (strcmp(name, PositionNames[i]) == 0) {
            return (PositionType)i;
        }
    }
    return SERVICE_CREW;
}








// Gets integer input from user with validation and range checking
int getIntInput(const char *prompt, int min, int max) {
    int value;
    while (1) {
        if (prompt) printf("%s", prompt);
        if (scanf("%d", &value) != 1) {
            printf("\t\t\t\t\tInvalid input. Please enter a valid number.\n");
            clearInputBuffer();
            continue;
        }
        clearInputBuffer();
        if (value < min || value > max) {
            printf("\t\t\t\t\tPlease enter a value between %d and %d.\n", min, max);
            continue;
        }
        return value;
    }
}








// Gets string input from user with validation, trimming, and optional character restrictions
void getStringInput(const char *prompt, char *out, int maxlen, int letters_spaces_only) {
    while (1) {
        if (prompt) printf("%s", prompt);
        if (!fgets(out, maxlen, stdin)) {
            clearInputBuffer();
            printf("\t\t\t\t\tInput error. Please try again.\n");
            continue;
        }
        
        size_t n = strlen(out);
        if (n > 0 && out[n-1] == '\n') out[n-1] = '\0';
        else if (n == (size_t)maxlen - 1) clearInputBuffer();
        
        char *start = out;
        while (*start && isspace((unsigned char)*start)) start++;
        char *end = out + strlen(out) - 1;
        while (end > start && isspace((unsigned char)*end)) end--;
        *(end + 1) = '\0';
        
        if (start != out) memmove(out, start, strlen(start) + 1);
        
        if (strlen(out) == 0) {
            printf("\t\t\t                                         Input cannot be empty or just spaces.\n");
            continue;
        }
        
        if (letters_spaces_only) {
            int ok = 1;
            int has_letter = 0;
            for (size_t i = 0; i < strlen(out); ++i) {
                if (isalpha((unsigned char)out[i])) {
                    has_letter = 1;
                } else if (out[i] != ' ' && out[i] != '-' && out[i] != '.') {
                    ok = 0;
                    break;
                }
            }
            if (!ok) {
                printf("\t\t\t\t\tInvalid characters detected. Use only letters, spaces, hyphens, or periods.\n");
                continue;
            }
            if (!has_letter) {
                printf("\t\t\t\t\tName must contain at least one letter.\n");
                continue;
            }
        }
        
        if (strlen(out) < 2) {
            printf("\t\t\t\t\tName must be at least 2 characters long.\n");
            continue;
        }
        
        if (strlen(out) > 48) {
            printf("\t\t\t\t\tName is too long. Maximum 48 characters.\n");
            continue;
        }
        
        return;
    }
}








// Gets the current system date and time formatted as YYYY-MM-DD and HH:MM
void getCurrentDateTime(char *date, char *timeBuf) {
    time_t t = time(NULL);
    struct tm tm = *localtime(&t);
    sprintf(date, "%04d-%02d-%02d", tm.tm_year + 1900, tm.tm_mon + 1, tm.tm_mday);
    sprintf(timeBuf, "%02d:%02d", tm.tm_hour, tm.tm_min);
}








// FILE HANDLING

// Saves all employee records to the payroll file
void saveToFile(void) {
    FILE *fp = fopen(FILENAME, "w");
    if (!fp) {
        printf("\n\t\t\t\t\tError: Unable to save data to %s\n", FILENAME);
        return;
    }
    
    fprintf(fp, "%d\n", employeeCount);
    for (int i = 0; i < employeeCount; i++) {
        fprintf(fp, "%d\n%s\n%s\n%.2f\n%d\n%.2f\n%.2f\n%.2f\n%.2f\n%.2f\n%.2f\n%.2f\n%.2f\n%.2f\n%.2f\n",
            employees[i].empID,
            employees[i].name,
            PositionNames[employees[i].position],
            employees[i].monthlySalary,
            employees[i].daysWorked,
            employees[i].totalOvertimeHours,
            employees[i].totalHoursWorked,
            employees[i].lastOvertimePay,
            employees[i].lastDailyRate,
            employees[i].lastAbsentDeduct,
            employees[i].lastGrossPay,
            employees[i].lastNetPay,
            employees[i].lastSSS,
            employees[i].lastPhilHealth,
            employees[i].lastPagIBIG,
            employees[i].lastIncomeTax
        );
    }
    fclose(fp);
}








// Loads all employee records from the payroll file
void loadFromFile(void) {
    FILE *fp = fopen(FILENAME, "r");
    if (!fp) {
        printf("\t\t\t\t\tNo existing payroll file found. Starting fresh.\n");
        employeeCount = 0;
        return;
    }
    
    if (fscanf(fp, "%d\n", &employeeCount) != 1) {
        printf("\t\t\t\t\tError reading employee count from file. Starting fresh.\n");
        employeeCount = 0;
        fclose(fp);
        return;
    }

    char posName[50];
    for (int i = 0; i < employeeCount && i < MAX_EMPLOYEES; i++) {
        if (fscanf(fp, "%d\n", &employees[i].empID) != 1) break;

        if (!fgets(employees[i].name, sizeof(employees[i].name), fp)) break;
        employees[i].name[strcspn(employees[i].name, "\n")] = 0;

        if (!fgets(posName, sizeof(posName), fp)) break;
        posName[strcspn(posName, "\n")] = 0;
        employees[i].position = getPositionTypeByName(posName);

        if (fscanf(fp, "%f\n%d\n%f\n%f\n%f\n%f\n%f\n%f\n%f\n%f\n%f\n%f\n%f\n",
            &employees[i].monthlySalary,
            &employees[i].daysWorked,
            &employees[i].totalOvertimeHours,
            &employees[i].totalHoursWorked,
            &employees[i].lastOvertimePay,
            &employees[i].lastDailyRate,
            &employees[i].lastAbsentDeduct,
            &employees[i].lastGrossPay,
            &employees[i].lastNetPay,
            &employees[i].lastSSS,
            &employees[i].lastPhilHealth,
            &employees[i].lastPagIBIG,
            &employees[i].lastIncomeTax) != 13) break;
    }

    if (employeeCount > 0) {
        printf("\t\t\t\t\tLoaded %d employees and their payroll data from file.\n", employeeCount);
    }
    fclose(fp);
}








// Saves all attendance records to the attendance file
void saveAttendanceToFile(void) {
    FILE *fp = fopen(ATTENDANCE_FILE, "w");
    if (!fp) {
        printf("\n\t\t\t\t\tError: Unable to save attendance data to %s\n", ATTENDANCE_FILE);
        return;
    }
    
    fprintf(fp, "%d\n", attendanceCount);
    for (int i = 0; i < attendanceCount; i++) {
        fprintf(fp, "%d\n%s\n%s\n%.2f\n%s\n%d\n%.2f\n",
            attendanceRecords[i].empID,
            attendanceRecords[i].date,
            attendanceRecords[i].timeIn,
            attendanceRecords[i].hoursWorked,
            attendanceRecords[i].status,
            attendanceRecords[i].isLate,
            attendanceRecords[i].overtimeHours
        );
    }
    fclose(fp);
}








// Loads all attendance records from the attendance file
void loadAttendanceFromFile(void) {
    FILE *fp = fopen(ATTENDANCE_FILE, "r");
    if (!fp) {
        printf("\t\t\t\t\tNo existing attendance file found. Starting fresh.\n");
        attendanceCount = 0;
        return;
    }
    
    if (fscanf(fp, "%d\n", &attendanceCount) != 1) {
        printf("\t\t\t\t\tError reading attendance count from file. Starting fresh.\n");
        attendanceCount = 0;
        fclose(fp);
        return;
    }

    for (int i = 0; i < attendanceCount && i < MAX_ATTENDANCE_RECORDS; i++) {
        if (fscanf(fp, "%d\n", &attendanceRecords[i].empID) != 1) break;

        if (!fgets(attendanceRecords[i].date, sizeof(attendanceRecords[i].date), fp)) break;
        attendanceRecords[i].date[strcspn(attendanceRecords[i].date, "\n")] = 0;

        if (!fgets(attendanceRecords[i].timeIn, sizeof(attendanceRecords[i].timeIn), fp)) break;
        attendanceRecords[i].timeIn[strcspn(attendanceRecords[i].timeIn, "\n")] = 0;

        if (fscanf(fp, "%f\n", &attendanceRecords[i].hoursWorked) != 1) break;

        if (!fgets(attendanceRecords[i].status, sizeof(attendanceRecords[i].status), fp)) break;
        attendanceRecords[i].status[strcspn(attendanceRecords[i].status, "\n")] = 0;

        if (fscanf(fp, "%d\n%f\n", 
            &attendanceRecords[i].isLate,
            &attendanceRecords[i].overtimeHours) != 2) break;
    }

    if (attendanceCount > 0) {
        printf("\t\t\t\t\tLoaded %d attendance records from file.\n", attendanceCount);
    }
    fclose(fp);
}








// Generates and saves a payslip to a text file for a specific employee
void printPaySlipToFile(const Employee *e) {
    char filename[MAX_STR];
    sprintf(filename, "payslip_%d.txt", e->empID);

    FILE *fp = fopen(filename, "w");
    if (!fp) {
        printf("\n\t\t\t\t                          ERROR: Unable to create file %s.\n", filename);
        return;
    }

    float totalDeduction = e->lastSSS + e->lastPhilHealth + e->lastPagIBIG + e->lastIncomeTax;
    float actualBasicPay = e->lastDailyRate * e->daysWorked;

    fprintf(fp, "================================================\n");
    fprintf(fp, "         OFFICIAL MONTHLY SALARY SLIP          \n");
    fprintf(fp, "================================================\n");
    fprintf(fp, "Employee ID:               %d\n", e->empID);
    fprintf(fp, "Employee Name:             %s\n", e->name);
    fprintf(fp, "Position:                  %s\n", PositionNames[e->position]);
    fprintf(fp, "Fixed Monthly Salary Base: Php%.2f\n", e->monthlySalary);
    fprintf(fp, "Standard Working Days:     %d\n", STANDARD_WORKING_DAYS);
    fprintf(fp, "Daily Rate:                Php%.2f\n", e->lastDailyRate);
    fprintf(fp, "Days Worked:               %d\n", e->daysWorked);
    if ((STANDARD_WORKING_DAYS - e->daysWorked) > 0) {
        fprintf(fp, "Days Absent:               %d\n", STANDARD_WORKING_DAYS - e->daysWorked);
    }
    fprintf(fp, "------------------------------------------------\n");
    fprintf(fp, "EARNINGS:\n");
    fprintf(fp, "  - Basic Salary (Days Worked):    Php%.2f\n", actualBasicPay);
    // Overtime removed from slip 
    if (e->lastAbsentDeduct > 0) {
        fprintf(fp, "  - Less: Absent Deduction:         Php%.2f\n", e->lastAbsentDeduct);
    }
    fprintf(fp, "GROSS PAY:                         Php%.2f\n", e->lastGrossPay);
    fprintf(fp, "------------------------------------------------\n");
    fprintf(fp, "MANDATORY DEDUCTIONS:\n");
    fprintf(fp, "  - SSS (4.5%%):                   Php%.2f\n", e->lastSSS);
    fprintf(fp, "  - PhilHealth (2.5%%):            Php%.2f\n", e->lastPhilHealth);
    fprintf(fp, "  - Pag-IBIG (2%%):                Php%.2f\n", e->lastPagIBIG);
    fprintf(fp, "  - Withholding Tax:               Php%.2f\n", e->lastIncomeTax);
    fprintf(fp, "------------------------------------------------\n");
    fprintf(fp, "TOTAL DEDUCTIONS:                  Php%.2f\n", totalDeduction);
    fprintf(fp, "NET SALARY (Take Home):            Php%.2f\n", e->lastNetPay);
    fprintf(fp, "================================================\n");

    fclose(fp);
    printf("\n\t\t\t\t                          Salary Slip successfully saved to file: %s\n", filename);
}








// ATTENDANCE SYSTEM 

// Displays the attendance management menu and handles user choices
void attendanceMenu(void) {
    system(CLEAR_COMMAND);
    int choice;
    do {
        printf("\n\t\t\t\t                                        ATTENDANCE MANAGEMENT\n");
    printf("\n\t\t\t\t                                        1. Time In Today\n");
    printf("\t\t\t\t                                        2. Absent\n");
    printf("\t\t\t\t                                        3. BACK TO ADMIN MENU\n");
    printf("\t\t\t\t                                        4. SORT EMPLOYEES BY ID (ascending)\n");
        printf("\n\t\t\t\t                                          Choice: ");
        
        if (scanf("%d", &choice) != 1) {
            printf("\n\t\t\t\t                                        Invalid input. Please enter a number.\n");
            clearInputBuffer();
            continue;
        }
        clearInputBuffer();
        
        switch (choice) {
            case 1: recordTimeIn(); break;
            case 2: recordAbsent(); break;
                case 3: printf("\n\t\t\t\t                                        Returning to Admin Menu.\n"); break;
                case 4: sortEmployeesByID(); break;
            default: printf("\n\t\t\t\t                                        Invalid choice. Please select 1-4.\n");
        }
        if (choice != 3) pressEnterToContinue();
    } while (choice != 3);
}

// Records a time-in entry for an employee with current date and time
void recordTimeIn(void) {
    system(CLEAR_COMMAND);
    printf("\n\t\t\t\t                                        EMPLOYEE TIME IN\n");
    
    if (employeeCount == 0) {
        printf("\t\t\t\t                                      No employees registered in the system.\n");
        return;
    }
    
    int empID;
    printf("\t\t\t\t                             Enter Employee ID: ");
    if (scanf("%d", &empID) != 1) {
        printf("\t\t\t\t                                        Invalid ID format. Please enter numbers only.\n");
        clearInputBuffer();
        return;
    }
    clearInputBuffer();
    
    if (empID < 1000000 || empID > 9999999) {
        printf("\t\t\t\t                     Employee ID. Must be 7 digits (1000000-9999999).\n");
        return;
    }
    
    int empIndex = findEmployeeIndexByID(empID);
    
    if (empIndex == -1) {
        printf("\t\t\t\t                                 Employee ID not found. Please check your ID and try again.\n");
        return;
    }
    
    char currentDate[11], currentTime[6];
    getCurrentDateTime(currentDate, currentTime);
    
    for (int i = 0; i < attendanceCount; i++) {
        if (attendanceRecords[i].empID == empID && 
            strcmp(attendanceRecords[i].date, currentDate) == 0) {
            printf("\t\t\t\t                                 You have already timed in today at %s.\n", attendanceRecords[i].timeIn);
            return;
        }
    }
    
    // Create new attendance record
    if (attendanceCount < MAX_ATTENDANCE_RECORDS) {
        AttendanceRecord newRecord = {0};
        newRecord.empID = empID;
        strcpy(newRecord.date, currentDate);
        strcpy(newRecord.timeIn, currentTime);
        newRecord.hoursWorked = 8.0f;
        strcpy(newRecord.status, "Present");
        newRecord.isLate = 0;
        
        attendanceRecords[attendanceCount++] = newRecord;
        saveAttendanceToFile();
        
        printf("\n\t\t\t\t                                  Time-In Recorded Successfully!\n");
        printf("\t\t\t\t                                  Employee:      %s\n", employees[empIndex].name);
        printf("\t\t\t\t                                  Date:          %s\n", currentDate);
        printf("\t\t\t\t                                  Time-In:       %s\n", currentTime);
        printf("\t\t\t\t                                  Status:        %s\n", newRecord.status);
    } else {
        printf("\t\t\t\t                     Attendance records limit reached. Cannot record time-in.\n");
    }
}

// Records an absent entry for an employee
void recordAbsent(void) {
    system(CLEAR_COMMAND);
    printf("\n\t\t\t\t                                        RECORD ABSENT\n");
    
    if (employeeCount == 0) {
        printf("\t\t\t\t                           No employees registered in the system.\n");
        return;
    }
    
    int empID;
    printf("\t\t\t\t                             Enter Employee ID: ");
    if (scanf("%d", &empID) != 1) {
        printf("\t\t\t\t                       Invalid ID format. Please enter numbers only.\n");
        clearInputBuffer();
        return;
    }
    clearInputBuffer();
    
    if (empID < 1000000 || empID > 9999999) {
        printf("\t\t\t\t                Invalid Employee ID. Must be 7 digits (1000000-9999999).\n");
        return;
    }
    
    int empIndex = findEmployeeIndexByID(empID);
    
    if (empIndex == -1) {
        printf("\t\t\t\t\tEmployee ID not found. Please check your ID and try again.\n");
        return;
    }
    
    char currentDate[11], currentTime[6];
    getCurrentDateTime(currentDate, currentTime);
    
    for (int i = 0; i < attendanceCount; i++) {
        if (attendanceRecords[i].empID == empID && 
            strcmp(attendanceRecords[i].date, currentDate) == 0) {
            printf("\t\t\t\t\tAttendance for this employee has already been recorded for today.\n");
            return;
        }
    }
    
    // Create new absent record
    if (attendanceCount < MAX_ATTENDANCE_RECORDS) {
        AttendanceRecord newRecord = {0};
        newRecord.empID = empID;
        strcpy(newRecord.date, currentDate);
        strcpy(newRecord.timeIn, "00:00");
        newRecord.hoursWorked = 0.0f;
        strcpy(newRecord.status, "Absent");
        newRecord.isLate = 0;
        newRecord.overtimeHours = 0.0f;
        
        attendanceRecords[attendanceCount++] = newRecord;
        saveAttendanceToFile();
        
        printf("\n\t\t\t\t\tAbsent Recorded Successfully!\n");
        printf("\t\t\t\t\tEmployee:  %s\n", employees[empIndex].name);
        printf("\t\t\t\t\tDate:      %s\n", currentDate);
        printf("\t\t\t\t\tStatus:    Absent\n");
    } else {
        printf("\t\t\t\t\tAttendance records limit reached. Cannot record absent.\n");
    }
}








// Displays attendance summary for all employees with days worked and absent information
void viewAttendance(void) {
    system(CLEAR_COMMAND);
    printf("\n\t\t\t               EMPLOYEE ATTENDANCE\n");
    
    if (employeeCount == 0) {
        printf("\t\t\t               No employees registered in the system.\n");
        return;
    }
    
    int daysAbsentArray[MAX_EMPLOYEES] = {0};
    int hasAbsences = 0;

    for (int i = 0; i < employeeCount; i++) {
        int daysWorked = 0;
        int daysAbsent = 0;
        float totalOvertime = 0.0;
        
        for (int j = 0; j < attendanceCount; j++) {
            if (attendanceRecords[j].empID == employees[i].empID) {
                if (strcmp(attendanceRecords[j].status, "Present") == 0) {
                    daysWorked++;
                } else if (strcmp(attendanceRecords[j].status, "Absent") == 0) {
                    daysAbsent++;
                }
                totalOvertime += attendanceRecords[j].overtimeHours;
            }
        }
        
        employees[i].daysWorked = daysWorked;
        employees[i].totalOvertimeHours = totalOvertime;
        
        if (daysAbsent > 0) hasAbsences = 1;
        daysAbsentArray[i] = daysAbsent;
    }
    
    printf("\n\n\t\t\t               ========================================================================================\n");
    printf("\t\t\t               | %-7s  %-35s  %-25s  %-10s  |\n", "ID", "Name", "Days Worked", "Absent");
    printf("\t\t\t               ========================================================================================\n\n");
    
    for (int i = 0; i < employeeCount; i++) {
        int daysWorked = employees[i].daysWorked;
        int daysAbsent = daysAbsentArray[i];
        
        printf("\t\t\t                 %-7d  %-35s  %-25d  %-10d  \n\n",
                employees[i].empID,
                employees[i].name,
                daysWorked,
                daysAbsent);
    }
    printf("\t\t\t               ----------------------------------------------------------------------------------------\n");
    
    saveToFile();
}








// SALARY COMPUTATION 

// Calculates income tax based on Philippine 2024 tax brackets
float calculateIncomeTax(float taxableIncome) {
    if (taxableIncome <= TAX_TIER_1_LIMIT) {
        return 0.00f;
    } else if (taxableIncome <= TAX_TIER_2_LIMIT) {
        return (taxableIncome - TAX_TIER_1_LIMIT) * TAX_RATE_TIER_2;
    } else if (taxableIncome <= TAX_TIER_3_LIMIT) {
        return TAX_BASE_TIER_3 + (taxableIncome - TAX_TIER_2_LIMIT) * TAX_RATE_TIER_3;
    } else if (taxableIncome <= TAX_TIER_4_LIMIT) {
        return TAX_BASE_TIER_4 + (taxableIncome - TAX_TIER_3_LIMIT) * TAX_RATE_TIER_4;
    } else if (taxableIncome <= TAX_TIER_5_LIMIT) {
        return TAX_BASE_TIER_5 + (taxableIncome - TAX_TIER_4_LIMIT) * TAX_RATE_TIER_5;
    } else {
        return TAX_BASE_TIER_6 + (taxableIncome - TAX_TIER_5_LIMIT) * TAX_RATE_TIER_6;
    }
}








// Calculates and displays monthly salary computation for all employees
void calculateAndDisplaySalary(void) {
    system(CLEAR_COMMAND);
    if (employeeCount == 0) {
        printf("\n\t\t\t                                             No employees for salary computation.\n");
        return;
    }

    printf("\n\t\t\t                            Monthly Salary Computation (Attendance Based)\n");
    printf("\t\t\t                                 (Based on %d Standard Working Days)\n\n", STANDARD_WORKING_DAYS);

    printf("\t\t                 ==================================================================================================\n");
    printf("\t\t                 | %-7s %-20s    %-5s   %-10s   %-11s   %-10s   %-11s   |\n",  "ID", "Name", "Days", "Daily Rate", "Basic Salary", "Deductions", "Net Salary");
    printf("\t\t                 ==================================================================================================\n");

    for (int i = 0; i < employeeCount; i++) {
        // Calculate rates
        float dailyRate = employees[i].monthlySalary / STANDARD_WORKING_DAYS;
        float hourlyRate = dailyRate / 8.0f;

        // Calculate Basic Pay (only for days actually worked)
        float basicSalary = dailyRate * employees[i].daysWorked;
        if (basicSalary < 0.0f) basicSalary = 0.0f;
        
        float absentDeduct = 0.0f;
        if (employees[i].daysWorked < STANDARD_WORKING_DAYS) {
            absentDeduct = (STANDARD_WORKING_DAYS - employees[i].daysWorked) * dailyRate;
        }

        // Overtime removed
        float overtimePay = 0.0f;
        // Calculate Gross Pay without overtime (absent deduction already reflected in lower basicSalary)
        float grossPay = basicSalary;
        if (grossPay < 0.0f) grossPay = 0.0f;

        // Calculate mandatory deductions (only if grossPay is positive)
        float sssDeduct = 0.0f;
        float philhealthDeduct = 0.0f;
        float pagibigDeduct = 0.0f;
        float incomeTaxDeduct = 0.0f;
        
        if (grossPay > 0.0f) {
            sssDeduct = grossPay * DEDUCTION_SSS_RATE;
            philhealthDeduct = grossPay * DEDUCTION_PHILHEALTH_RATE;
            pagibigDeduct = grossPay * DEDUCTION_PAGIBIG_RATE;
            
            // Calculate taxable income
            float taxableIncome = grossPay;
            
            // Calculate Income Tax
            incomeTaxDeduct = calculateIncomeTax(taxableIncome);
        }

        // Final calculation
        float totalDeduction = sssDeduct + philhealthDeduct + pagibigDeduct + incomeTaxDeduct;
        float netSalary = grossPay - totalDeduction;
        if (netSalary < 0.0f) netSalary = 0.0f;

        // Store calculation results
        employees[i].lastDailyRate = dailyRate;
        employees[i].lastAbsentDeduct = absentDeduct;
        employees[i].lastOvertimePay = 0.0f;
        employees[i].lastGrossPay = grossPay;
        employees[i].lastNetPay = netSalary;
        employees[i].lastSSS = sssDeduct;
        employees[i].lastPhilHealth = philhealthDeduct;
        employees[i].lastPagIBIG = pagibigDeduct;
        employees[i].lastIncomeTax = incomeTaxDeduct;

        printf("\n\t\t                 %-7d   %-20s    %-5d   %-10.2f   %-11.2f    %-10.2f   %-11.2f \n\n",
                employees[i].empID, 
                employees[i].name, 
                employees[i].daysWorked,
                dailyRate,
                basicSalary, 
                totalDeduction,
                netSalary);
    }
    printf("\t\t                 --------------------------------------------------------------------------------------------------\n");
    saveToFile();
    printf("\n\t\t\t                                  All monthly salary computations completed and saved.\n");
}








// Displays a detailed salary slip for a specific employee
void displayEmployeeSalarySlip(int id) {
    system(CLEAR_COMMAND);
    int idx = findEmployeeIndexByID(id);

    if (idx == -1) {
        printf("\n\t\t\t\t                                         Employee with ID %d not found.\n", id);
        return;
    }
    
    if (employees[idx].lastGrossPay == 0.0f && employees[idx].daysWorked == 0) {
        printf("\n\t\t\t\t                              Salary computation has not been run for this employee yet.\n");
        printf("\t\t\t\t                             Please run 'Calculate & View Monthly Salary Computation' first.\n");
        return;
    }

    printf("\n\t\t\t\t                          ==========================================\n");
    printf("\t\t\t\t                                   GENERATING SALARY SLIP\n");
    printf("\t\t\t\t                          ==========================================\n\n");
    fflush(stdout);
    
    // Animated processing similar to Kali Linux install process
    const char* stages[] = {
        "processing",
        "record system initializing",
        "computation starting",
        "deduction calculating"
    };
    int numStages = 4;
    int stageDuration = 750; // 750ms per stage = 3 seconds total
    
    for (int stage = 0; stage < numStages; stage++) {
        printf("\t\t\t\t                          [%d/%d] %s", stage + 1, numStages, stages[stage]);
        fflush(stdout);
        
        // Animate dots
        for (int dot = 0; dot < 15; dot++) {
            printf(".");
            fflush(stdout);
            SLEEP_FUNCTION(stageDuration / 15);
        }
        
        printf(" [OK]\n");
        fflush(stdout);
    }
    
    printf("\n\t\t\t\t                          ==========================================\n");
    printf("\t\t\t\t                            Salary Slip Generated Successfully!\n");
    printf("\t\t\t\t                          ==========================================\n\n");
    SLEEP_FUNCTION(500);
    
    Employee e = employees[idx];

    printf("\n\t\t\t\t                          ========= MONTHLY SALARY SLIP =========\n");
    printf("\t\t\t\t                          Employee ID:           %d\n", e.empID);
    printf("\t\t\t\t                          Employee Name:         %s\n", e.name);
    printf("\t\t\t\t                          Position:              %s\n", PositionNames[e.position]);
    printf("\t\t\t\t                          Monthly Salary Base:   Php%.2f\n", e.monthlySalary);
    printf("\t\t\t\t                          Daily Rate:            Php%.2f\n", e.lastDailyRate);
    printf("\t\t\t\t                          Days Worked:           %d / %d\n", e.daysWorked, STANDARD_WORKING_DAYS);
    printf("\t\t\t\t                          -----------------------------------------\n");

    float totalDeduction = e.lastSSS + e.lastPhilHealth + e.lastPagIBIG + e.lastIncomeTax;
    float actualBasicPay = e.lastDailyRate * e.daysWorked;
    if (actualBasicPay < 0.0f) actualBasicPay = 0.0f;

    printf("\t\t\t\t                          EARNINGS:\n"); 
    printf("\t\t\t\t                          - Basic Salary (Days Worked):   Php%.2f\n", actualBasicPay);
    // Overtime removed from slip
    if (e.lastAbsentDeduct > 0.0f && e.daysWorked < STANDARD_WORKING_DAYS) {
        printf("\t\t\t\t                          - Less: Absent Deduction:        Php%.2f\n", e.lastAbsentDeduct); 
    }
    printf("\t\t\t\t                          -----------------------------------------\n");
    printf("\t\t\t\t                          TOTAL GROSS PAY:                 Php%.2f\n", e.lastGrossPay); 
    printf("\t\t\t\t                          -----------------------------------------\n");
    printf("\t\t\t\t                          DEDUCTIONS:\n");
    printf("\t\t\t\t                          - SSS (4.5%%):              Php%.2f\n", e.lastSSS);
    printf("\t\t\t\t                          - PhilHealth (2.5%%):       Php%.2f\n", e.lastPhilHealth);
    printf("\t\t\t\t                          - Pag-IBIG (2%%):           Php%.2f\n", e.lastPagIBIG);
    printf("\t\t\t\t                          - Income Tax:              Php%.2f\n", e.lastIncomeTax);
    printf("\t\t\t\t                          -----------------------------------------\n");
    printf("\t\t\t\t                          TOTAL DEDUCTIONS:          Php%.2f\n", totalDeduction);
    printf("\t\t\t\t                          NET SALARY:                Php%.2f\n", e.lastNetPay);
    printf("\t\t\t\t                          =========================================\n");

    printf("\n\t\t\t\t               Do you want to print this salary slip to a text file? (Y/N): ");
    char choice = 'N';
    if (scanf(" %c", &choice) != 1) choice = 'N';
    clearInputBuffer();

    if (choice == 'Y' || choice == 'y') {
        printPaySlipToFile(&e);
    }
}








// Employee Management

// Displays a list of all employees in the system
void viewEmployees(void) {
    system(CLEAR_COMMAND);
    if (employeeCount == 0) {
        printf("\n\t\t\t\t                                   There is no employees yet.\n");
        return;
    }

    printf("\n\n\t\t\t                 %d EMPLOYEE RECORDS\n", employeeCount);
    printf("\t\t\t               ========================================================================================\n");
    printf("\t\t\t               | %-8s   %-30s   %-22s  %-14s   |\n", "ID", "Name", "Position", "Monthly Base");
    printf("\t\t\t               ========================================================================================\n");

    for (int i = 0; i < employeeCount; i++) {
        printf("\n\t\t\t                 %-8d   %-30s   %-22s   Php%-11.2f  \n",
                employees[i].empID,
                employees[i].name,
                PositionNames[employees[i].position],
                employees[i].monthlySalary);
    }
    printf("\n\n\t\t\t               ----------------------------------------------------------------------------------------\n");
}














// Sort employees in-place by Employee ID using Insertion Sort (stable, efficient for small N)
void sortEmployeesByID(void) {
    if (employeeCount <= 1) return;
    for (int i = 1; i < employeeCount; i++) {
        Employee key = employees[i];
        int j = i - 1;
        while (j >= 0 && employees[j].empID > key.empID) {
            employees[j + 1] = employees[j];
            j--;
        }
        employees[j + 1] = key;
    }
    saveToFile();
    printf("\nEmployees sorted by ID successfully and saved to file.\n");
}

// Sort employees in-place by Name using Insertion Sort (ascending A-Z)
void sortEmployeesByName(void) {
    if (employeeCount <= 1) return;
    for (int i = 1; i < employeeCount; i++) {
        Employee key = employees[i];
        int j = i - 1;

        // Use case-insensitive comparison for alphabetical ordering
        while (j >= 0 && strcasecmp(employees[j].name, key.name) > 0) {
            employees[j + 1] = employees[j];
            j--;
        }
        employees[j + 1] = key;
    }
    saveToFile();
    printf("\nEmployees sorted by Name successfully and saved to file.\n");
}








// Adds a new employee to the system
void addEmployee(void) {
    system(CLEAR_COMMAND);
    if (employeeCount >= MAX_EMPLOYEES) {
        printf("\n\t\t\t\t\tEmployee list is full (max %d). Cannot add more employees.\n", MAX_EMPLOYEES);
        return;
    }

    Employee e;
    printf("\n\t\t\t\t                                        ADD NEW EMPLOYEE\n");
    
    // Generate random 7-digit ID
    e.empID = generateEmployeeID();
    printf("\t\t\t                                         Generated Employee ID: %d\n", e.empID);
    
    // Get name with duplicate validation
    char name[50];
    while (1) {
        getStringInput("\n\t\t\t\t                             Enter Full Name: ", name, sizeof(name), 1);
        
        if (findEmployeeIndexByName(name) != -1) {
            printf("\t\t\t\t                    Employee with name '%s' already exists!\n", name);
            printf("\t\t\t\t                                   Please enter a different person.\n");
            continue;
        }
        break;
    }
    strcpy(e.name, name);

    printf("\n\t\t\t\t                                         SELECT POSITION\n");
    for (int i = 0; i < NUM_POSITIONS; i++) {
        printf("\t\t\t\t                           %d. %s       Php%.2f per month\n",   i + 1, PositionNames[i],       PositionMonthlySalaries[i]);
    }
    int posChoice = getIntInput("\n\n\t\t\t\t                                          Choice: ", 1, NUM_POSITIONS);





    e.position = (PositionType)(posChoice - 1);
    e.monthlySalary = PositionMonthlySalaries[e.position];
    
    e.daysWorked = 0;

    // Initialize all calculation fields
    e.totalOvertimeHours = 0.0f;
    e.totalHoursWorked = 0.0f;
    e.lastOvertimePay = 0.0f;
    e.lastDailyRate = 0.0f;
    e.lastAbsentDeduct = 0.0f;
    e.lastGrossPay = 0.0f;
    e.lastNetPay = 0.0f;
    e.lastSSS = 0.0f;
    e.lastPhilHealth = 0.0f;
    e.lastPagIBIG = 0.0f;
    e.lastIncomeTax = 0.0f;

    printf("\n\t\t\t\t                                         EMPLOYEE DETAIL\n");
    printf("\n\t\t\t\t                                  ID:                %d\n", e.empID);
    printf("\t\t\t\t                                  Name:              %s\n", e.name);
    printf("\t\t\t\t                                  Position:          %s\n", PositionNames[e.position]);
    printf("\t\t\t\t                                  Monthly Salary:    Php%.2f\n", e.monthlySalary);
    
    printf("\n\t\t\t\t\tConfirm Add? (Y to confirm, any other key to cancel): ");
    char c = 'N';
    if (scanf(" %c", &c) != 1) c = 'N';
    clearInputBuffer();

    if (c == 'Y' || c == 'y') {
        employees[employeeCount++] = e;
        saveToFile();
        printf("\n\t\t\t\t                    Employee '%s' added successfully with ID: %d.\n", e.name, e.empID);
    } else {
        printf("\n\t\t\t\t                                Adding cancelled. No changes made.\n");
    }
}








// Updates an existing employee's information
void updateEmployee(void) {
    system(CLEAR_COMMAND);
    if (employeeCount == 0) {
        printf("\n\t\t\t\t                                There is no employees yet to update.\n");
        return;
    }
    printf("\n\t\t\t\t                                        UPDATE EMPLOYEE\n");
    
    int id;
    printf("\n\t\t\t\t                             Enter Employee ID to update: ");
    if (scanf("%d", &id) != 1) {
        printf("\t\t\t\t                             Invalid ID format.\n");
        clearInputBuffer();
        return;
    }
    clearInputBuffer();
    
    if (id < 1000000 || id > 9999999) {
        printf("\t\t\t\t                                Invalid Employee ID. Must be 7 digits.\n");
        return;
    }
    
    int idx = findEmployeeIndexByID(id);

    if (idx == -1) {
        printf("\n\t\t\t\t                                Employee with ID %d not found.\n", id);
        return;
    }

    Employee *e = &employees[idx];
    Employee old = *e;

    printf("\n\t\t\t\t                                  Current Employee Details\n");
    printf("\t\t\t\t                                  Name:        %s\n", e->name);
    printf("\t\t\t\t                                  Position:    %s (Php%.2f/month)\n", PositionNames[e->position], e->monthlySalary);
    printf("\t\t\t\t                                  Days Worked: %d\n", e->daysWorked);

    printf("\n\t\t\t\t                                Which field do you want to update?\n");
    printf("\t\t\t\t                                1) Name\n");
    printf("\t\t\t\t                                2) Position and Monthly Salary\n");
    printf("\t\t\t\t                                3) Back\n");
    int choice = getIntInput("\t\t\t\t                                          Choice: ", 1, 3);

    if (choice == 3) {
        printf("\n\t\t\t\t                              Update cancelled.\n");
        return;
    }

    switch (choice) {
        case 1: {
            char newName[50];
            while (1) {
                getStringInput("\n\t\t\t\t                             Enter new full name: ", newName, sizeof(newName), 1);
                
                if (isNameDuplicate(newName, e->empID)) {
                    printf("\t\t\t\t                    The Employee with name '%s' already exists!\n", newName);
                    printf("\t\t\t\t                    Sorry you can't add the same person.\n");
                    continue;
                }
                break;
            }
            if (strcmp(e->name, newName) == 0) {
                printf("\t\t\t\t                         New name is the same as current name. Update cancelled.\n");
                return;
            }
            strcpy(e->name, newName);
            printf("\t\t\t\t                                 Name updated to: %s\n", e->name);
            break;
        }
        case 2: {
            printf("\n\t\t\t\t                                  SELECT NEW POSITION\n");
            for (int i = 0; i < NUM_POSITIONS; i++) {
                printf("\t\t\t\t                                  %d. %s (Php%.2f per month)\n",
                        i + 1, PositionNames[i], PositionMonthlySalaries[i]);
            }
            int posChoice = getIntInput("\t\t\t\t                                          Choice: ", 1, NUM_POSITIONS);
            PositionType newPosition = (PositionType)(posChoice - 1);
            if (e->position == newPosition) {
                printf("\t\t\t\t                         New position is the same as current position. Update cancelled.\n");
                return;
            }
            e->position = newPosition;
            e->monthlySalary = PositionMonthlySalaries[e->position];
            printf("\n\t\t\t\t                    Position updated to %s (Php%.2f/month).\n", PositionNames[e->position], e->monthlySalary);
            break;
        }
    }

    printf("\t\t\t\t                    Confirm update? (Y to confirm, any other key to cancel): ");
    char c = 'N';
    if (scanf(" %c", &c) != 1) c = 'N';
    clearInputBuffer();

    if (c == 'Y' || c == 'y') {
        saveToFile();
        printf("\n\t\t\t\t                             Employee updated and saved successfully.\n");
    } else {
        *e = old;
        printf("\n\t\t\t\t                            Update cancelled; original record restored.\n");
    }
}








// Removes an employee from the system
void removeEmployee(void) {
    system(CLEAR_COMMAND);
    if (employeeCount == 0) {
        printf("\n\t\t\t\t                                There is no employees yet to remove.\n");
        pressEnterToContinue();
        return;
    }
    
    printf("\n\t\t\t\t                                        REMOVE EMPLOYEE\n");
    
    int id;
    while (1) {
        printf("\n\t\t\t\t                        Enter Employee ID to remove (or 0 to cancel): ");
        if (scanf("%d", &id) != 1) {
            printf("\t\t\t\t                                Invalid ID format. Please enter numbers only.\n");
            clearInputBuffer();
            continue;
        }
        clearInputBuffer();
        
        if (id == 0) {
            printf("\n\t\t\t\t                                Remove operation cancelled.\n");
            return;
        }
        
        if (id < 1000000 || id > 9999999) {
            printf("\t\t\t\t                                Invalid Employee ID. Must be 7 digits.\n");
            continue;
        }
        
        int idx = findEmployeeIndexByID(id);
        if (idx == -1) {
            printf("\t\t\t\t                   Employee with ID %d not found. Please enter a valid ID.\n", id);
            continue;
        }
        break;
    }
    
    int idx = findEmployeeIndexByID(id);
    printf("\n\t\t\t\t                                   EMPLOYEE TO BE REMOVED\n");
    printf("\t\t\t\t                                  ID:              %d\n", employees[idx].empID);
    printf("\t\t\t\t                                  Name:            %s\n", employees[idx].name);
    printf("\t\t\t\t                                  Position:        %s\n", PositionNames[employees[idx].position]);
    printf("\t\t\t\t                                  Monthly Salary:  Php%.2f\n", employees[idx].monthlySalary);
    
    printf("\n\t\t\t\t                       ARE YOU SURE YOU WANT TO REMOVE THIS EMPLOYEE?\n");
    printf("\t\t\t\t    This action cannot be undone! (Type 'REMOVE' to confirm, any other key to cancel): ");
    
    char confirmation[10];
    if (!fgets(confirmation, sizeof(confirmation), stdin)) {
        printf("\n\t\t\t\t\tRemoval cancelled. No changes made.\n");
        pressEnterToContinue();
        return;
    }
    
    confirmation[strcspn(confirmation, "\n")] = 0;
    
    if (strcmp(confirmation, "REMOVE") == 0) {
        char deletedName[50];
        strcpy(deletedName, employees[idx].name);
        int deletedID = employees[idx].empID;
        
        // Remove employee from array
        employees[idx] = employees[employeeCount - 1];
        --employeeCount;
        
        // Remove attendance records for this employee
        int newAttendanceCount = 0;
        for (int i = 0; i < attendanceCount; i++) {
            if (attendanceRecords[i].empID != deletedID) {
                attendanceRecords[newAttendanceCount] = attendanceRecords[i];
                newAttendanceCount++;
            }
        }
        attendanceCount = newAttendanceCount;
        
        saveToFile();
        saveAttendanceToFile();
        
        printf("\n\t\t\t\t\tEmployee '%s' (ID: %d) Removed successfully.\n", deletedName, deletedID);
    } else {
        printf("\n\t\t\t\t\tRemoval cancelled. No changes made.\n");
    }
    
    pressEnterToContinue();
}








// ADMIN AND MAIN MENU

// Verifies admin PIN for accessing admin functions
int verifyPin(void) {
    int pin;
    int attempts = 3;
    
    while (attempts > 0) {
        system(CLEAR_COMMAND);
        printf("\n\t\t\t\t                                    %d Attempts remaining ", attempts);
        printf("\n\n\t\t\t\t                                   Enter Admin PIN (0000): ");
        if (scanf("%d", &pin) != 1) {
            clearInputBuffer();
            printf("\t\t\t\t                             Invalid input. Please enter numbers only.\n");
            attempts--;
            continue;
        }
        clearInputBuffer();
        if (pin == ADMIN_PIN) {
            printf("\n\t\t\t\t                                          Login successful.\n");
            return 1;
        } else {
            printf("\t\t\t\t                                          Login failed.\n");
            attempts--;
        }
    }
    
    printf("\n\t\t\t\t                             Too many failed attempts. Access denied.\n");
    return 0;
}








// Displays and handles the admin control panel menu
void adminMenu(void) {
    system(CLEAR_COMMAND);
    int choice;
    do {
        printf("\n\n\t\t\t\t                                        ADMIN CONTROL PANEL                \n");
        printf("\n\n\t\t\t\t                                        - RECORD  SYSTEM -                      \n");
        printf("\t\t\t\t                                    1. VIEW ALL EMPLOYEE RECORD               \n");
        printf("\t\t\t\t                                    2. ADD    NEW      EMPLOYEE                    \n");
        printf("\t\t\t\t                                    3. UPDATE  EMPLOYEE  DETAIL                  \n");
        printf("\t\t\t\t                                    4. REMOVE          EMPLOYEE                       \n");
        printf("\t\t\t\t                                    5. EMPLOYEE SORTING OPTIONS                         \n");
        printf("\n\n\t\t\t\t                                        - ATTENDANCE RECORD -                   \n");
        printf("\t\t\t\t                                    6. ATTENDANCE     DASHBOARD                     \n");
        printf("\t\t\t\t                                    7. VIEW          ATTENDANCE                       \n");
        printf("\n\n\t\t\t\t                                       - SALARY COMPUTATION -                            \n");
        printf("\t\t\t\t                                    8. VIEW MONTHLY SALARY COMPUTATION            \n");
        printf("\t\t\t\t                                    9. GENERATE  SLIP   BY   ID                       \n");
    printf("\n\t\t\t\t                                    10. BACK     TO    MAIN MENU                              \n");
        printf("\n\n\t\t\t\t                                          Choice: ");

        if (scanf("%d", &choice) != 1) {
            printf("\n\t\t\t\t                             2.   Invalid input. Please enter a number.\n");
            clearInputBuffer();
            continue;
        }
        clearInputBuffer();

        switch (choice) {
            case 1: viewEmployees();              break;
            case 2: addEmployee();                break;
            case 3: updateEmployee();             break;
            case 4: removeEmployee();             break;
            case 5: {
                int sortChoice = 0;
                do {
                    system(CLEAR_COMMAND);
                    printf("\n\t\t\t\t                                        EMPLOYEE SORTING OPTIONS\n");
                    printf("\t\t\t\t                                        1. Sort by ID\n");
                    printf("\t\t\t\t                                        2. Sort by Name\n");
                    printf("\t\t\t\t                                        3. Back\n");
                    sortChoice = getIntInput("\n\t\t\t\t                                          Choice: ", 1, 3);
                    if (sortChoice == 1) {
                        sortEmployeesByID();
                        pressEnterToContinue();
                    } else if (sortChoice == 2) {
                        sortEmployeesByName();
                        pressEnterToContinue();
                    }
                } while (sortChoice != 3);
                break;
            }
            case 6: attendanceMenu();             break;
            case 7: viewAttendance(); break;
            case 8: calculateAndDisplaySalary();  break;
            case 9: {
                int id = getIntInput("\n\t\t\t\t                                Enter Employee ID for Salary Slip: ", 1000000, 9999999);
                displayEmployeeSalarySlip(id);
                break;
            }
            case 10: printf("\n\t\t\t\t                             2.   Logging out of Admin.\n"); break;
            default: printf("\n\t\t\t\t                             2.   Invalid choice. Please select 1-10.\n");
        }
        if (choice != 9) pressEnterToContinue();
    } while (choice != 9);
}








// Displays and handles the main menu of the system
void mainMenu(void) {
    int choice;
    do {
        system(CLEAR_COMMAND);
        printf("\n\n\n\t\t\t    ** ** **  ** **      ** **  ** ** **   **           ** ** **      **        **    ** ** **    ** ** **     \n");
        printf("\t\t\t    **        **  **    **  **  **     **  **         **        **     **      **     **          **                 \n");
        printf("\t\t\t    **        **   **  **   **  **     **  **        **          **     **    **      **          **                 \n");
        printf("\t\t\t    ** ** **  **     **     **  ** ** **   **        **          **      **  **       ** ** **    ** ** **           \n");
        printf("\t\t\t    **        **            **  **         **        **          **        **         **          **                 \n");
        printf("\t\t\t    **        **            **  **         **        **          **        **         **          **                 \n");
        printf("\t\t\t    **        **            **  **         **         **        **         **         **          **                 \n");
        printf("\t\t\t    ** ** **  **            **  **         ** ** **     ** ** **           **         ** ** **    ** ** **           \n");
        printf("\n\t\t\t\t                                       RECORD SYSTEM           \n\n");
        printf("\n\n\t\t\t\t                             1.         ADMIN LOGIN           ");
        printf("\n\n\t\t\t\t                             2.   VIEW ALL EMPLOYEE RECORDS     ");
        printf("\n\n\t\t\t\t                             3.         EXIT SYSTEM             ");
        printf("\n\n\n\t\t\t\t                                          Choice: ");

        if (scanf("%d", &choice) != 1) {
            printf("\n\t\t\t\t                             Invalid input. Please enter a number.\n");
            clearInputBuffer();
            continue;
        }

        clearInputBuffer();

        switch (choice) {
            case 1:
                if (verifyPin()) adminMenu();
                else pressEnterToContinue();
                break;
            case 2:
                viewEmployees();
                pressEnterToContinue();
                break;
            case 3:
                printf("\n\t\t\t\t                            Exiting system. All changes saved.\n");
                break;
            default:
                printf("\n\t\t\t\t                            Invalid choice. Please select 1-3.\n");
                pressEnterToContinue();
        }
    } while (choice != 3);
}








// Main entry point of the program
int main(void) {
    printf("\t\t\t\t                             Loading employee data...\n");
    loadFromFile();
    loadAttendanceFromFile();
    mainMenu();
    return 0;
}

